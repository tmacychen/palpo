# Palpo Admin UI 功能测试计划

## 文档信息

- **版本**: 1.0
- **创建日期**: 2026年2月2日
- **测试对象**: Palpo Admin UI (Leptos + WASM)
- **测试类型**: 功能测试、集成测试、UI/UX 测试

---

## 1. 测试目标

### 1.1 主要目标
1. 验证所有 UI 功能按预期工作
2. 确保用户交互流程顺畅
3. 验证 API 集成的正确性
4. 检查错误处理和边界条件
5. 评估用户体验和界面响应性

### 1.2 测试范围

#### 包含范围
- ✅ 认证系统（登录/登出）
- ✅ Dashboard 页面功能
- ✅ 用户管理功能
- ✅ 房间管理功能
- ✅ 联邦管理功能
- ✅ 服务器信息展示
- ✅ 布局组件和导航
- ✅ 错误处理和提示
- ✅ 响应式设计

#### 不包含范围
- ❌ 性能测试（压力测试、负载测试）
- ❌ 安全测试（渗透测试）
- ❌ 可访问性测试（WCAG 标准）
- ❌ 浏览器兼容性测试（仅测试 Chrome/Firefox）

---

## 2. 测试环境

### 2.1 硬件环境
- **开发机器**: macOS / Linux / Windows
- **内存**: 8GB+ RAM
- **CPU**: 4+ cores

### 2.2 软件环境

#### 后端服务
- **Palpo Server**: 运行在 `http://localhost:8008`
- **数据库**: PostgreSQL 14+
- **Node**: 用于运行测试工具

#### 前端环境
- **浏览器**: Chrome 120+ / Firefox 120+
- **WASM 支持**: 启用 WebAssembly
- **开发服务器**: Trunk (端口 8080)

### 2.3 测试数据准备

```bash
# 1. 启动 Palpo 服务器
cargo run -p palpo

# 2. 在另一个终端启动 UI 开发服务器
cd crates/ui
trunk serve --port 8080

# 3. 准备测试数据
# - 创建至少 5 个测试用户
# - 创建至少 3 个测试房间
# - 配置至少 2 个联邦服务器
```

**测试账号**: 
- 用户名: `@admin:localhost:8008`
- 密码: `admin`

---

## 3. 测试策略

### 3.1 测试方法

1. **手动测试**: 人工执行测试用例，验证 UI 交互
2. **自动化测试**: 使用 Playwright/Cypress 进行 E2E 测试
3. **单元测试**: 测试独立的函数和组件
4. **集成测试**: 测试 API 调用和数据流

### 3.2 测试优先级

| 优先级 | 功能模块 | 测试重点 |
|--------|----------|----------|
| P0 | 认证系统 | 登录流程、Token 管理 |
| P0 | Dashboard | 数据展示、统计卡片 |
| P1 | 用户管理 | CRUD 操作、搜索筛选 |
| P1 | 房间管理 | 列表、详情、操作 |
| P2 | 联邦管理 | 服务器列表、连接状态 |
| P2 | 服务器信息 | 信息展示 |
| P3 | UI 组件 | 布局、导航、提示 |

### 3.3 测试通过标准

- **功能通过率**: 100% 的 P0 和 P1 测试用例通过
- **缺陷等级**: 无 Critical 和 High 级别缺陷
- **用户体验**: 所有交互响应时间 < 2 秒
- **错误处理**: 所有错误场景有明确的用户提示

---

## 4. 详细测试用例

### 4.1 认证系统测试

#### TC001: 登录功能测试

**测试目标**: 验证管理员登录流程

**前置条件**:
- Palpo 服务器运行正常
- 浏览器已打开 `http://localhost:8080`

**测试步骤**:
| 步骤 | 操作 | 预期结果 |
|------|------|----------|
| 1 | 访问登录页面 | 显示登录表单，包含用户名、密码、服务器地址输入框 |
| 2 | 输入服务器地址 | 自动填充当前域名或上次保存的地址 |
| 3 | 输入正确的用户名和密码 | 输入框显示输入的字符，密码显示为圆点 |
| 4 | 勾选"记住我" | 复选框被选中 |
| 5 | 点击"登录"按钮 | 按钮显示加载动画，发起登录请求 |
| 6 | 等待登录响应 | 登录成功，跳转到 Dashboard 页面 |
| 7 | 检查 localStorage | Token 被保存到 localStorage |

**测试数据**:
- 用户名: `@admin:localhost:8008`
- 密码: `admin`
- 服务器地址: `http://localhost:8008`

**预期结果**: ✅ 登录成功，跳转到 Dashboard

---

#### TC002: 登录验证测试

**测试目标**: 验证登录表单验证

**测试场景**:

| 场景 | 输入数据 | 预期错误 |
|------|----------|----------|
| 空用户名 | 密码: admin, 服务器: http://localhost:8008 | "请输入用户名和密码" |
| 空密码 | 用户名: @admin:localhost:8008, 服务器: http://localhost:8008 | "请输入用户名和密码" |
| 空服务器地址 | 用户名: @admin:localhost:8008, 密码: admin | "请输入服务器地址" |
| 错误密码 | 用户名: @admin:localhost:8008, 密码: wrongpass | 登录失败提示 |
| 错误服务器地址 | 服务器: http://invalid:8008 | 网络错误提示 |
| 格式错误的用户名 | 用户名: invalid-user | 登录失败提示 |

**验证点**:
- 错误提示清晰明确
- 登录按钮在验证失败时保持可用
- 网络错误有超时处理（30 秒）

---

#### TC003: Token 管理测试

**测试目标**: 验证 Token 存储和自动验证

**测试步骤**:

1. **Token 存储测试**
   - 登录成功
   - 打开浏览器 DevTools → Application → LocalStorage
   - 检查 `palpo_admin_token` 是否存在
   - 检查 Token 格式是否为字符串

2. **自动登录测试**
   - 登录成功并保存 Token
   - 刷新页面
   - 预期: 自动跳转到 Dashboard，不显示登录页

3. **Token 验证测试**
   - 在 Dashboard 页面打开 DevTools
   - 检查网络请求是否包含 Authorization header
   - 检查 `/account/whoami` 请求是否成功

4. **Token 过期测试**
   - 手动修改 localStorage 中的 Token 为无效值
   - 刷新页面
   - 预期: 自动跳转到登录页，显示错误提示

---

#### TC004: 登出功能测试

**测试目标**: 验证登出流程

**测试步骤**:

1. 登录并进入 Dashboard
2. 点击顶部导航栏的用户头像/菜单
3. 点击"登出"选项
4. 预期结果:
   - Token 从 localStorage 中删除
   - 页面跳转到登录页
   - 可以再次正常登录

---

### 4.2 Dashboard 页面测试

#### TC005: 页面加载测试

**测试目标**: 验证 Dashboard 页面正确加载

**测试步骤**:

| 步骤 | 验证点 | 预期结果 |
|------|--------|----------|
| 1 | 页面标题 | 显示"Dashboard"和描述文字 |
| 2 | 统计卡片 | 显示 4 个卡片：用户总数、房间总数、联邦服务器、服务器版本 |
| 3 | 卡片数据 | 显示具体数字（非占位符） |
| 4 | 页面布局 | 布局正确，无重叠元素 |
| 5 | 响应式设计 | 窗口缩放时布局自适应 |

---

#### TC006: 统计卡片功能测试

**测试目标**: 验证统计卡片的数据展示

**测试卡片**:

1. **用户总数卡片**
   - 显示格式: `1,234`（千位分隔符）
   - 显示增长率: `+12% 较上月`
   - 显示图标: 用户图标
   - 数据验证: 对比 API 返回数据

2. **房间总数卡片**
   - 显示格式: `567`
   - 显示增长率: `+8% 较上月`
   - 显示图标: 房间图标
   - 数据验证: 对比 API 返回数据

3. **联邦服务器卡片**
   - 显示格式: `42`
   - 显示状态: `全部在线`
   - 显示图标: 联邦图标
   - 数据验证: 对比 API 返回数据

4. **服务器版本卡片**
   - 显示格式: `0.1.0`（语义化版本）
   - 显示状态: `运行中`
   - 显示图标: 设置图标

**验证点**:
- 数据格式正确
- 数字动画效果流畅
- 图标显示正确

---

#### TC007: 近期注册用户组件测试

**测试目标**: 验证用户列表展示

**测试步骤**:

1. **列表显示**
   - 检查是否显示最近注册的用户
   - 每个用户显示：头像、用户名、注册时间、状态

2. **用户信息验证**
   - 用户名格式: `@username:server.com`
   - 时间显示: `2小时前`、`1天前`等相对时间
   - 状态标签: `活跃`（绿色）、`离线`（灰色）

3. **交互测试**
   - 点击用户名: 跳转到用户详情页（如果有）
   - 点击"查看全部": 跳转到用户管理页

4. **空状态测试**
   - 如果没有新用户: 显示"暂无新用户"提示

---

#### TC008: 系统状态监控测试

**测试目标**: 验证系统状态展示

**测试项目**:

| 状态项 | 正常状态 | 异常状态 |
|--------|----------|----------|
| 数据库连接 | 绿色圆点 + "正常" | 红色圆点 + "异常" |
| 联邦连接 | 绿色圆点 + "正常" | 红色圆点 + "异常" |
| 媒体存储 | 百分比显示 | 超过 90% 显示警告 |
| 运行时间 | 天数和小时 | 正常累加 |

**验证点**:
- 状态图标颜色正确
- 百分比计算准确
- 运行时间格式: `15天 8小时`

---

#### TC009: 快捷操作测试

**测试目标**: 验证快捷操作按钮

**操作按钮**:

1. **创建用户**
   - 点击按钮
   - 预期: 跳转到用户创建页面（如果已实现）

2. **创建房间**
   - 点击按钮
   - 预期: 跳转到房间创建页面（如果已实现）

3. **查看日志**
   - 点击按钮
   - 预期: 跳转到日志页面（如果已实现）

4. **系统设置**
   - 点击按钮
   - 预期: 跳转到设置页面（如果已实现）

**验证点**:
- 按钮悬停效果（颜色变化）
- 按钮点击反馈
- 页面跳转正确

---

### 4.3 用户管理测试

#### TC010: 用户列表测试

**测试目标**: 验证用户列表功能

**测试步骤**:

1. **页面访问**
   - 点击侧边栏"用户管理"菜单
   - 预期: 加载用户列表页面

2. **列表显示**
   - 检查表头: 用户 ID、显示名称、状态、创建时间、操作
   - 检查数据行: 至少显示 10 行
   - 检查分页: 底部显示分页控件

3. **数据验证**
   - 用户 ID 格式正确
   - 状态标签: `活跃`、`停用`、`访客`
   - 时间格式: `YYYY-MM-DD HH:mm`

4. **空状态**
   - 如果没有用户: 显示"暂无用户"和创建按钮

---

#### TC011: 用户搜索和筛选测试

**测试目标**: 验证搜索和筛选功能

**搜索测试**:

| 搜索条件 | 输入值 | 预期结果 |
|----------|--------|----------|
| 用户 ID | `@admin` | 显示包含 admin 的用户 |
| 显示名称 | `Alice` | 显示显示名包含 Alice 的用户 |
| 完整用户 ID | `@alice:server.com` | 精确匹配 |
| 特殊字符 | `@user-test` | 正确处理连字符 |

**筛选测试**:

1. **按状态筛选**
   - 全部（默认）
   - 仅活跃用户
   - 仅停用用户
   - 仅访客用户

2. **按管理员筛选**
   - 仅管理员
   - 仅普通用户

3. **组合筛选**
   - 搜索 + 状态筛选
   - 搜索 + 管理员筛选

**验证点**:
- 搜索结果实时更新
- 筛选条件组合正确
- 结果数量显示正确

---

#### TC012: 用户详情测试

**测试目标**: 验证用户详情展示

**测试步骤**:

1. **打开详情**
   - 点击用户列表中的"详情"按钮
   - 预期: 打开详情抽屉或新页面

2. **详情信息验证**
   - 用户 ID
   - 显示名称
   - 头像（如果有）
   - 状态: 活跃/停用/访客
   - 管理员权限: 是/否
   - 影子封禁: 是/否
   - 创建时间
   - 最后登录时间
   - 外部 ID（如果有）

3. **编辑功能**
   - 点击"编辑"按钮
   - 预期: 进入编辑模式

---

#### TC013: 用户创建测试

**测试目标**: 验证创建新用户

**测试步骤**:

1. 点击"创建用户"按钮
2. 填写表单:
   - 用户 ID: `@newuser:localhost:8008`
   - 显示名称: `New User`
   - 密码: `newuser123`
   - 确认密码: `newuser123`
   - 是否管理员: 勾选
3. 点击"创建"按钮
4. 预期结果:
   - 创建成功提示
   - 新用户出现在列表中
   - 可以登录新用户账号

**表单验证测试**:

| 验证项 | 错误输入 | 预期错误 |
|--------|----------|----------|
| 用户 ID 格式 | `invalid-user` | "用户 ID 格式不正确" |
| 密码强度 | `123` | "密码太短" |
| 密码不匹配 | 密码和确认密码不同 | "密码不匹配" |
| 重复用户 ID | 已存在的用户 ID | "用户已存在" |

---

#### TC014: 用户编辑测试

**测试目标**: 验证编辑用户信息

**测试步骤**:

1. 选择用户并点击"编辑"
2. 修改字段:
   - 显示名称: 修改为新的值
   - 管理员权限: 切换开关
   - 影子封禁: 切换开关
3. 点击"保存"
4. 预期结果:
   - 保存成功提示
   - 信息更新
   - 权限变更生效

**测试场景**:

| 场景 | 操作 | 验证 |
|------|------|------|
| 修改显示名称 | 更改显示名并保存 | API 返回更新后的值 |
| 提升为管理员 | 启用管理员开关 | 用户获得管理员权限 |
| 降级普通用户 | 关闭管理员开关 | 用户失去管理员权限 |
| 启用影子封禁 | 启用影子封禁 | 用户无法发送消息 |
| 禁用影子封禁 | 关闭影子封禁 | 用户恢复正常 |

---

#### TC015: 用户停用/启用测试

**测试目标**: 验证停用和启用用户

**停用测试**:

1. 选择活跃用户
2. 点击"停用"按钮
3. 确认对话框点击"确定"
4. 预期:
   - 用户状态变为"停用"
   - 无法登录该用户

**启用测试**:

1. 选择停用用户
2. 点击"启用"按钮
3. 预期:
   - 用户状态变为"活跃"
   - 可以正常登录

---

#### TC016: 密码重置测试

**测试目标**: 验证重置用户密码

**测试步骤**:

1. 选择用户
2. 点击"重置密码"按钮
3. 输入新密码: `newpassword123`
4. 确认新密码: `newpassword123`
5. 点击"确认"
6. 预期:
   - 密码重置成功
   - 可以使用新密码登录

**验证测试**:
- 旧密码无法登录
- 新密码可以登录

---

### 4.4 房间管理测试

#### TC017: 房间列表测试

**测试目标**: 验证房间列表功能

**测试步骤**:

1. 点击侧边栏"房间管理"菜单
2. 预期: 加载房间列表页面
3. 检查表头: 房间 ID、名称、成员数、创建时间、状态、操作
4. 检查数据行: 至少显示 10 行
5. 检查分页: 底部显示分页控件

**数据验证**:
- 房间 ID 格式: `!roomid:server.com`
- 房间名称: 显示真实名称或房间 ID
- 成员数: 数字显示
- 状态: `活跃`、`封禁`

---

#### TC018: 房间搜索和排序测试

**测试目标**: 验证房间搜索和排序

**搜索测试**:

| 搜索条件 | 输入值 | 预期结果 |
|----------|--------|----------|
| 房间 ID | `!test` | 显示包含 test 的房间 |
| 房间名称 | `General` | 显示名称包含 General 的房间 |
| 完整房间 ID | `!abc123:server.com` | 精确匹配 |

**排序测试**:

1. **按创建时间排序**
   - 最新优先（默认）
   - 最早优先

2. **按成员数排序**
   - 最多成员优先
   - 最少成员优先

3. **按名称排序**
   - A-Z 排序
   - Z-A 排序

**验证点**:
- 排序箭头图标显示正确
- 点击表头切换排序
- 排序状态持久化

---

#### TC019: 房间详情测试

**测试目标**: 验证房间详情展示

**测试步骤**:

1. 点击房间列表中的"详情"按钮
2. 预期: 打开详情抽屉
3. 验证信息:
   - 房间 ID
   - 房间名称
   - 创建者
   - 创建时间
   - 成员数量
   - 房间版本
   - 联邦状态
   - 加密状态

---

#### TC020: 房间成员列表测试

**测试目标**: 验证房间成员展示

**测试步骤**:

1. 在房间详情中点击"成员"标签
2. 检查成员列表:
   - 用户 ID
   - 显示名称
   - 权限等级
   - 加入时间
3. 验证权限:
   - 管理员（100）
   - 版主（50）
   - 普通成员（0）

---

#### TC021: 房间封禁/解封测试

**测试目标**: 验证封禁和解封房间

**封禁测试**:

1. 选择活跃房间
2. 点击"封禁"按钮
3. 确认对话框点击"确定"
4. 预期:
   - 房间状态变为"封禁"
   - 成员无法发送消息

**解封测试**:

1. 选择封禁房间
2. 点击"解封"按钮
3. 预期:
   - 房间状态变为"活跃"
   - 成员可以正常发送消息

---

#### TC022: 房间删除测试

**测试目标**: 验证删除房间

**测试步骤**:

1. 选择房间
2. 点击"删除"按钮
3. 确认对话框:
   - 显示警告信息
   - 要求输入"DELETE"确认
4. 输入"DELETE"并确认
5. 预期:
   - 房间从列表中移除
   - 房间数据被删除
   - 成员被移出房间

**验证点**:
- 确认对话框有双重验证
- 错误输入无法删除
- 删除操作不可逆

---

### 4.5 联邦管理测试

#### TC023: 联邦服务器列表测试

**测试目标**: 验证联邦服务器列表

**测试步骤**:

1. 点击侧边栏"联邦管理"菜单
2. 预期: 加载联邦服务器列表
3. 检查表头: 服务器名称、状态、延迟、共享房间数、操作
4. 检查数据行: 显示所有联邦服务器

**数据验证**:
- 服务器名称: `matrix.org`, `mozilla.org` 等
- 状态: `在线`、`离线`、`连接中`
- 延迟: 毫秒数（如 45ms）
- 共享房间数: 数字

---

#### TC024: 联邦服务器详情测试

**测试目标**: 验证服务器详情

**测试步骤**:

1. 点击服务器列表中的"详情"按钮
2. 预期: 打开详情抽屉
3. 验证信息:
   - 服务器名称
   - 状态
   - 最后连接时间
   - 失败尝试次数
   - 延迟图表（如果有）
   - 共享房间列表

---

#### TC025: 重置连接测试

**测试目标**: 验证重置联邦连接

**测试步骤**:

1. 选择状态为"离线"的服务器
2. 点击"重置连接"按钮
3. 预期:
   - 发起重置请求
   - 显示加载状态
   - 状态变为"连接中"
   - 成功后变为"在线"

**验证点**:
- 仅离线服务器显示重置按钮
- 重置过程有进度提示
- 失败时显示错误信息

---

#### TC026: 共享房间查询测试

**测试目标**: 验证查询共享房间

**测试步骤**:

1. 在服务器详情中点击"共享房间"标签
2. 点击"查询"按钮
3. 预期:
   - 显示与该服务器共享的房间列表
   - 显示房间 ID 和名称
   - 点击房间可跳转到房间详情

---

### 4.6 服务器信息测试

#### TC027: 服务器信息展示测试

**测试目标**: 验证服务器信息显示

**测试步骤**:

1. 点击侧边栏"服务器信息"菜单
2. 预期: 加载服务器信息页面
3. 验证信息类别:
   - **基本信息**: 版本、运行时间、启动时间
   - **配置信息**: 服务器名称、端口、数据库配置
   - **限制配置**: 最大房间数、最大用户数等
   - **联邦配置**: 是否启用联邦、允许的服务器列表
   - **安全配置**: 是否启用加密、密码策略

**验证点**:
- 所有配置正确显示
- 敏感信息（密码）被隐藏
- 配置按分类展示
- 只读信息显示正确

---

### 4.7 布局和导航测试

#### TC028: 侧边栏导航测试

**测试目标**: 验证侧边栏导航功能

**测试步骤**:

1. **菜单项显示**
   - 检查所有菜单项:
     - Dashboard
     - 用户管理
     - 房间管理
     - 联邦管理
     - 服务器信息

2. **菜单交互**
   - 点击每个菜单项
   - 预期: 正确跳转到对应页面
   - 当前页面菜单高亮显示

3. **折叠/展开**
   - 点击折叠按钮
   - 预期: 侧边栏收缩，仅显示图标
   - 再次点击展开

4. **响应式设计**
   - 窗口宽度 < 768px
   - 预期: 侧边栏自动隐藏，显示汉堡菜单
   - 点击汉堡菜单显示侧边栏

---

#### TC029: 顶部导航栏测试

**测试目标**: 验证顶部导航栏功能

**测试步骤**:

1. **面包屑导航**
   - 检查路径显示: `Dashboard > 用户管理`
   - 点击面包屑可返回上级

2. **用户菜单**
   - 点击用户头像/名称
   - 预期: 显示下拉菜单
   - 菜单包含: 个人信息、设置、登出

3. **通知图标**
   - 点击通知图标（如果有）
   - 预期: 显示通知列表

4. **主题切换**
   - 点击主题切换按钮（如果有）
   - 预期: 切换深色/浅色主题

---

#### TC030: 页面加载状态测试

**测试目标**: 验证页面加载状态

**测试场景**:

| 场景 | 预期加载状态 |
|------|--------------|
| 页面初次加载 | 显示加载动画，内容渐显 |
| API 请求 | 显示加载动画，数据加载完成后显示 |
| 切换页面 | 平滑过渡，无闪烁 |
| 数据刷新 | 显示刷新图标，数据更新 |

**加载动画验证**:
- 旋转动画流畅
- 加载文案清晰
- 错误状态有重试按钮

---

### 4.8 错误处理和提示测试

#### TC031: 错误提示组件测试

**测试目标**: 验证错误提示的显示

**测试场景**:

1. **API 错误**
   - 模拟 401 未授权
   - 预期: 显示"登录已过期，请重新登录"

2. **网络错误**
   - 断开网络连接
   - 预期: 显示"网络连接失败"

3. **权限错误**
   - 尝试访问无权限资源
   - 预期: 显示"权限不足"

4. **服务器错误**
   - 模拟 500 错误
   - 预期: 显示"服务器内部错误"

**提示样式验证**:
- 错误: 红色边框和背景
- 警告: 黄色边框和背景
- 成功: 绿色边框和背景
- 信息: 蓝色边框和背景

---

#### TC032: 网络超时处理测试

**测试目标**: 验证网络超时处理

**测试步骤**:

1. **慢速网络模拟**
   - 使用 Chrome DevTools 模拟 Slow 3G
   - 发起 API 请求
   - 预期: 显示加载状态，30 秒后显示超时错误

2. **超时重试**
   - 超时后点击"重试"按钮
   - 预期: 重新发起请求

3. **超时配置**
   - 验证所有 API 请求都有超时设置
   - 超时时间: 30 秒

---

### 4.9 响应式设计测试

#### TC033: 不同屏幕尺寸测试

**测试目标**: 验证响应式布局

**测试设备**:

1. **桌面端**
   - 分辨率: 1920x1080
   - 预期: 完整布局，侧边栏展开

2. **笔记本**
   - 分辨率: 1366x768
   - 预期: 完整布局，可能需要滚动

3. **平板横屏**
   - 分辨率: 1024x768
   - 预期: 侧边栏可折叠，表格横向滚动

4. **平板竖屏**
   - 分辨率: 768x1024
   - 预期: 侧边栏隐藏，汉堡菜单

5. **手机竖屏**
   - 分辨率: 375x667
   - 预期: 移动端优化布局

**测试内容**:
- 布局不重叠
- 文字可读
- 按钮可点击（最小 44x44px）
- 表格可横向滚动
- 模态框适配屏幕

---

### 4.10 数据一致性测试

#### TC034: 数据实时性测试

**测试目标**: 验证数据实时更新

**测试步骤**:

1. **手动刷新**
   - 在 Dashboard 点击刷新按钮
   - 预期: 数据重新加载，显示最新值

2. **自动刷新**
   - 等待 5 分钟（如果配置了自动刷新）
   - 预期: 数据自动更新

3. **跨页面数据一致性**
   - Dashboard 显示的用户总数
   - 用户管理页面的用户数量
   - 预期: 两个数字一致

4. **API 数据验证**
   - UI 显示的数据与直接调用 API 返回的数据对比
   - 预期: 数据完全一致

---

## 5. 测试工具和技术

### 5.1 手动测试工具

#### 浏览器开发工具
- **Chrome DevTools**: 元素检查、网络监控、Console
- **Firefox Developer Tools**: 同上
- **Safari Web Inspector**: 同上

#### 测试辅助插件
- **Redux DevTools**: 状态管理调试（如果有）
- **React Developer Tools**: 组件树检查
- **WASM 调试工具**: 查看 WASM 模块

### 5.2 自动化测试框架

#### Playwright (推荐)

**安装**:
```bash
npm install -D @playwright/test
test
```

**示例测试脚本**:
```typescript
import { test, expect } from '@playwright/test';

test('登录测试', async ({ page }) => {
  await page.goto('http://localhost:8080');
  
  // 填写登录表单
  await page.fill('input[id="server_url"]', 'http://localhost:8008');
  await page.fill('input[id="username"]', '@admin:localhost:8008');
  await page.fill('input[id="password"]', 'admin');
  
  // 点击登录
  await page.click('button[type="submit"]');
  
  // 验证登录成功
  await expect(page).toHaveURL('http://localhost:8080/dashboard');
  
  // 验证 Dashboard 内容
  await expect(page.locator('text=Dashboard')).toBeVisible();
});
```

#### Cypress (备选)

**安装**:
```bash
npm install -D cypress
```

### 5.3 测试环境配置

#### 创建测试配置文件

**`crates/ui/tests/playwright.config.ts`**:
```typescript
import { defineConfig } from '@playwright/test';

export default defineConfig({
  testDir: './tests',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: 'html',
  use: {
    baseURL: 'http://localhost:8080',
    trace: 'on-first-retry',
  },
  projects: [
    {
      name: 'chromium',
      use: { browserName: 'chromium' },
    },
  ],
  webServer: {
    command: 'cd crates/ui && trunk serve --port 8080',
    url: 'http://localhost:8080',
    reuseExistingServer: !process.env.CI,
  },
});
```

---

## 6. 测试执行计划

### 6.1 测试阶段

#### 阶段 1: 单元测试（1 天）
- 测试独立函数和组件
- 验证数据格式化函数
- 测试工具函数

#### 阶段 2: 集成测试（2 天）
- 测试 API 调用
- 验证数据流
- 测试状态管理

#### 阶段 3: 功能测试（3 天）
- 手动执行所有测试用例
- 验证 UI 交互
- 检查边界条件

#### 阶段 4: 回归测试（1 天）
- 修复问题后重新测试
- 验证修复效果
- 确保没有引入新问题

### 6.2 测试时间表

| 日期 | 测试内容 | 负责人 | 状态 |
|------|----------|--------|------|
| 第 1 天 | 环境搭建 + 单元测试 | 测试工程师 | 计划中 |
| 第 2 天 | 认证系统测试 | 测试工程师 | 计划中 |
| 第 3 天 | Dashboard 测试 | 测试工程师 | 计划中 |
| 第 4 天 | 用户管理测试 | 测试工程师 | 计划中 |
| 第 5 天 | 房间管理测试 | 测试工程师 | 计划中 |
| 第 6 天 | 联邦管理 + 服务器信息测试 | 测试工程师 | 计划中 |
| 第 7 天 | 回归测试 + 测试报告 | 测试工程师 | 计划中 |

### 6.3 缺陷管理流程

```
发现缺陷 → 记录缺陷 → 分配修复 → 修复验证 → 关闭缺陷
     ↓                                                ↑
     └────────────── 回归测试 ───────────────┘
```

**缺陷等级定义**:

- **Critical**: 系统崩溃，无法使用
- **High**: 主要功能无法使用
- **Medium**: 次要功能异常
- **Low**: UI/UX 小问题

**缺陷模板**:
```markdown
**缺陷 ID**: BUG-001
**标题**: 登录页面密码输入框不显示
**等级**: High
**重现步骤**:
1. 打开登录页面
2. 输入密码
**预期结果**: 密码显示为圆点
**实际结果**: 输入框无反应
**环境**: Chrome 120, macOS
**截图**: [附件]
```

---

## 7. 测试交付物

### 7.1 测试文档

1. **测试计划文档** (本文档)
   - 路径: `.codebuddy/docs/UI_TEST_PLAN.md`

2. **测试用例文档**
   - 格式: Markdown / Excel
   - 包含: 测试用例 ID、步骤、预期结果、实际结果、状态

3. **缺陷报告**
   - 格式: Markdown / JIRA
   - 包含: 缺陷列表、等级、状态

4. **测试报告**
   - 格式: PDF / Markdown
   - 包含: 测试总结、通过率、缺陷统计、建议

### 7.2 自动化测试脚本

**目录结构**:
```
crates/ui/tests/
├── e2e/
│   ├── login.spec.ts
│   ├── dashboard.spec.ts
│   ├── users.spec.ts
│   ├── rooms.spec.ts
│   └── federation.spec.ts
├── fixtures/
│   └── test-data.json
├── helpers/
│   ├── api-helpers.ts
│   └── ui-helpers.ts
└── playwright.config.ts
```

---

## 8. 风险评估和应对

### 8.1 技术风险

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| API 不稳定 | 中 | 高 | 使用 mock 数据，联系后端修复 |
| WASM 兼容性问题 | 低 | 中 | 限制支持的浏览器版本 |
| 测试环境配置复杂 | 中 | 中 | 编写详细配置文档，使用 Docker |
| 测试数据不足 | 中 | 中 | 编写数据生成脚本 |

### 8.2 进度风险

| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| 测试时间不足 | 中 | 高 | 优先级高的功能优先测试 |
| 缺陷修复延迟 | 中 | 中 | 每日站会跟踪进度 |
| 需求变更 | 低 | 高 | 及时更新测试用例 |

---

## 9. 成功标准

### 9.1 功能测试成功标准

- ✅ 所有 P0 和 P1 测试用例通过（100%）
- ✅ P2 测试用例通过率 ≥ 90%
- ✅ 无 Critical 和 High 级别缺陷
- ✅ Medium 级别缺陷 ≤ 5 个
- ✅ Low 级别缺陷 ≤ 10 个

### 9.2 性能标准

- ✅ 页面加载时间 < 3 秒
- ✅ API 响应时间 < 1 秒
- ✅ 交互响应时间 < 500ms
- ✅ WASM 模块加载时间 < 2 秒

### 9.3 用户体验标准

- ✅ 所有按钮和链接可点击
- ✅ 所有表单有适当的验证
- ✅ 错误提示清晰易懂
- ✅ 操作流程符合用户习惯
- ✅ 响应式设计正常工作

---

## 10. 附录

### 10.1 术语表

| 术语 | 解释 |
|------|------|
| P0 | 最高优先级，核心功能 |
| P1 | 高优先级，主要功能 |
| P2 | 中优先级，次要功能 |
| E2E | 端到端测试 |
| WASM | WebAssembly |
| CSR | 客户端渲染 |

### 10.2 参考文档

- [Palpo Admin API 文档](.codebuddy/docs/admin-api.md)
- [Leptos 官方文档](https://leptos-rs.github.io/leptos/)
- [Playwright 文档](https://playwright.dev/)

### 10.3 联系方式

- **测试负责人**: [待填写]
- **开发负责人**: [待填写]
- **项目经理**: [待填写]

---

**文档状态**: ✅ 已审核

**最后更新**: 2026年2月2日
